<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tài liệu VMC Query Builder Framework | Hướng dẫn Tương tác</title>
  <meta name="description"
    content="Tài liệu hướng dẫn tương tác đầy đủ cho VMC Query Builder, một framework ORM và xây dựng truy vấn SQL linh hoạt cho Spring Boot. Tìm hiểu cách cài đặt, định nghĩa entity, tạo repository, và sử dụng các tính năng nâng cao.">
  <meta name="author" content="NatswarChuan">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://natswarchuan.github.io/vmc-query-builder/">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://natswarchuan.github.io/vmc-query-builder/">
  <meta property="og:title" content="Tài liệu VMC Query Builder Framework | Hướng dẫn Tương tác">
  <meta property="og:description"
    content="Tài liệu hướng dẫn tương tác đầy đủ cho VMC Query Builder, một framework ORM và xây dựng truy vấn SQL linh hoạt cho Spring Boot. Tìm hiểu cách cài đặt, định nghĩa entity, tạo repository, và sử dụng các tính năng nâng cao.">
  <meta property="og:image" content="https://natswarchuan.github.io/vmc-query-builder/logo.jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://natswarchuan.github.io/vmc-query-builder/">
  <meta property="twitter:title" content="Tài liệu VMC Query Builder Framework | Hướng dẫn Tương tác">
  <meta property="twitter:description"
    content="Tài liệu hướng dẫn tương tác đầy đủ cho VMC Query Builder, một framework ORM và xây dựng truy vấn SQL linh hoạt cho Spring Boot. Tìm hiểu cách cài đặt, định nghĩa entity, tạo repository, và sử dụng các tính năng nâng cao.">
  <meta property="twitter:image" content="https://natswarchuan.github.io/vmc-query-builder/logo.jpeg">

  <link rel="icon" href="https://natswarchuan.github.io/vmc-query-builder/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="https://natswarchuan.github.io/vmc-query-builder/logo.jpeg">
  <link rel="sitemap" type="application/xml" title="Sitemap" href="./sitemap.xml">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>

<body class="bg-slate-50 text-slate-800">

  <div class="flex flex-col md:flex-row min-h-screen">
    <aside
      class="w-full md:w-64 lg:w-72 bg-white/90 backdrop-blur-sm border-r border-slate-200 p-4 md:p-6 md:sticky top-0 h-screen overflow-y-auto">
      <h1 class="text-xl font-bold text-slate-900 mb-6">VMC Query Builder</h1>
      <nav id="navigation" class="flex flex-col space-y-2">
        <a href="#gioi-thieu"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">1. Giới
          thiệu</a>
        <a href="#cai-dat"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">2. Cài đặt &
          Cấu hình</a>
        <a href="#dinh-nghia-entities"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">3. Định nghĩa
          Entities</a>
        <div>
          <a href="#anh-xa-quan-he"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">4.
            Ánh xạ Quan hệ</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#onetoone" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.1. One-to-One</a>
            <a href="#onetomany" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.2.
              One-to-Many</a>
            <a href="#manytomany" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.3.
              Many-to-Many</a>
            <a href="#lazy-loading" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.4. Lazy
              Loading & Cascade</a>
          </div>
        </div>
        <a href="#tao-repositories"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">5. Tạo
          Repositories</a>
        <div>
          <a href="#phuong-thuc-truy-van"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">6.
            Phương thức Truy vấn</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#derived-queries" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">6.1. Derived
              Queries</a>
            <a href="#vmc-query" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">6.2. @VMCQuery</a>
          </div>
        </div>
        <a href="#query-builder"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">7.
          VMCQueryBuilder</a>
        <a href="#service-layer"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">8. Lớp
          Service</a>
        <div>
          <a href="#dto"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">9.
            DTO & Chuyển đổi</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#dto-mechanism" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">9.1. Cơ chế
              Chuyển đổi</a>
            <a href="#dto-usage" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">9.2. Các hàm
              Service với DTO</a>
          </div>
        </div>
        <div>
          <a href="#validation"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">10.
            Validation Dữ liệu</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#validation-field" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">10.1.
              Validation trên Trường</a>
            <a href="#validation-class" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">10.2.
              Validation trên Lớp</a>
          </div>
        </div>
      </nav>
    </aside>

    <main class="flex-1 p-6 md:p-10">
      <div class="max-w-4xl mx-auto">
        <section id="gioi-thieu" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">1. Giới thiệu</h2>
          <p class="text-lg text-slate-700"><strong>VMC Query Builder</strong> là một mini-framework cung cấp các chức
            năng ORM (Object-Relational Mapping) và xây dựng truy vấn SQL một cách linh hoạt, được tích hợp sâu với
            Spring Boot. Framework này cho phép bạn tương tác với cơ sở dữ liệu quan hệ bằng cách sử dụng các đối tượng
            Java (Entities) và các interface (Repositories), giúp giảm thiểu việc viết mã SQL thủ công và tăng tốc độ
            phát triển.</p>
          <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
            <h3 class="text-xl font-semibold mb-3 text-slate-800">Các tính năng chính</h3>
            <ul class="list-disc list-inside space-y-2 text-slate-600">
              <li><strong>Ánh xạ dựa trên Annotation:</strong> Dễ dàng ánh xạ các lớp Java thành các bảng trong cơ sở dữ
                liệu.</li>
              <li><strong>Mô hình Repository:</strong> Cung cấp một lớp trừu tượng cho tầng truy cập dữ liệu, tương tự
                như Spring Data.</li>
              <li><strong>Truy vấn phái sinh (Derived Queries):</strong> Tự động sinh câu lệnh SQL từ tên của phương
                thức.</li>
              <li><strong>Query Builder linh hoạt:</strong> Cung cấp một API fluent để xây dựng các câu lệnh `SELECT`
                phức tạp.</li>
              <li><strong>Hỗ trợ các mối quan hệ:</strong> Quản lý đầy đủ các mối quan hệ `One-to-One`, `One-to-Many`,
                `Many-to-One`, và `Many-to-Many`.</li>
              <li><strong>Lazy Loading, Cascade & Orphan Removal:</strong> Tối ưu hóa hiệu năng và tự động hóa việc quản
                lý dữ liệu liên quan.</li>
              <li><strong>Tích hợp Service Layer & DTO:</strong> Cung cấp các lớp cơ sở để giảm mã lặp lại và dễ dàng
                chuyển đổi dữ liệu.</li>
              <li><strong>Validation Truy vấn:</strong> Cung cấp cơ chế validation mạnh mẽ dựa trên dữ liệu trong
                database.</li>
            </ul>
          </div>
        </section>

        <section id="cai-dat" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">2. Cài đặt & Cấu hình</h2>
          <p>Để bắt đầu, bạn cần tích hợp framework vào dự án Spring Boot của mình.</p>
          <h3 class="text-2xl font-semibold text-slate-800 pt-4">Bước 1: Thêm Dependency (Maven)</h3>
          <p>Đảm bảo `pom.xml` của bạn có các dependency cần thiết. Framework này sử dụng `spring-boot-starter-jdbc`.
          </p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-xml">&lt;dependencies&gt;
    &lt;!-- Spring Boot JDBC Starter --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt;
    &lt;/dependency&gt;
    
    &lt;!-- Spring Boot Validation Starter --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- Database Driver (ví dụ: MySQL) --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
          </div>

          <h3 class="text-2xl font-semibold text-slate-800 pt-4">Bước 2: Cấu hình DataSource</h3>
          <p>Trong file `application.properties`, cấu hình thông tin kết nối đến cơ sở dữ liệu.</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-properties">spring.datasource.url=jdbc:mysql://localhost:3306/vmc_db
spring.datasource.username=root
spring.datasource.password=
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</code></pre>
          </div>

          <h3 class="text-2xl font-semibold text-slate-800 pt-4">Bước 3: Kích hoạt VMC Repositories</h3>
          <p>Trong lớp Application chính, thêm annotation `@EnableVMCRepositories`.</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">import io.github.natswarchuan.vmc.core.config.EnableVMCRepositories;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@EnableVMCRepositories(basePackages = "io.github.natswarchuan.vmc.repository")
public class QueryBuilderApplication {

    public static void main(String[] args) {
        SpringApplication.run(QueryBuilderApplication.class, args);
    }
}</code></pre>
          </div>
        </section>

        <section id="dinh-nghia-entities" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">3. Định nghĩa Entities</h2>
          <p>Entities là các lớp Java đại diện cho các bảng trong cơ sở dữ liệu. Tất cả các entity phải kế thừa từ lớp
            `Model`.</p>
          <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md" role="alert">
            <p class="font-bold">Annotation cơ bản</p>
            <ul class="list-disc list-inside mt-2">
              <li><code>@VMCTable(name = "...")</code>: Đánh dấu lớp là entity và chỉ định tên bảng.</li>
              <li><code>@VMCPrimaryKey</code>: Đánh dấu trường là khóa chính.</li>
              <li><code>@VMCColumn(name = "...")</code>: Ánh xạ trường thành cột. Nếu không có `name`, tên cột sẽ được
                lấy từ tên trường.</li>
            </ul>
          </div>
          <h3 class="text-2xl font-semibold text-slate-800 pt-4">Ví dụ: Entity `User` từ `src`</h3>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">package io.github.natswarchuan.vmc.entity;

import io.github.natswarchuan.vmc.core.annotation.*;
import io.github.natswarchuan.vmc.core.entity.Model;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Set;

@VMCTable(name = "users")
public class User extends Model&lt;String&gt; {

    @VMCPrimaryKey
    private String id;

    @VMCColumn
    private String name;

    @VMCColumn
    private String email;

    @VMCColumn
    private String password;
    
    @VMCOneToOne(mappedBy = "user")
    @VMCOrphanRemoval
    private UserProfile profile;

    @VMCOneToMany(mappedBy = "user")
    @VMCOrphanRemoval
    private List&lt;Post&gt; posts;

    @VMCManyToMany
    @VMCJoinTable(
            name = "user_roles",
            joinColumns = @VMCJoinColumn(name = "user_id", referencedColumnName = "id"),
            inverseJoinColumns = @VMCJoinColumn(name = "role_id", referencedColumnName = "id")
    )
    private Set&lt;Role&gt; roles;

    // Getters, Setters, and mandatory ID methods
    @Override
    public String getId() {
        return id;
    }

    @Override
    public void setId(String id) {
        this.id = id;
    }
    // ...
}
</code></pre>
          </div>
        </section>

        <section id="anh-xa-quan-he" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">4. Ánh xạ Quan hệ</h2>
          <p>Framework hỗ trợ đầy đủ các mối quan hệ phổ biến trong ORM.</p>

          <article id="onetoone" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.1. One-to-One</h3>
            <p>Mỗi `User` có một `UserProfile`. Quan hệ này được định nghĩa bằng <code>@VMCOneToOne</code> và
              <code>@VMCJoinColumn</code>.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong User.java
@VMCOneToOne(mappedBy = "user")
@VMCOrphanRemoval
private UserProfile profile;

// Trong UserProfile.java
@VMCOneToOne
@VMCJoinColumn(name = "user_id", referencedColumnName = "id")
private User user;
</code></pre>
            </div>
          </article>

          <article id="onetomany" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.2. One-to-Many / Many-to-One</h3>
            <p>Một `User` có thể viết nhiều `Post`. Quan hệ này được thể hiện bằng <code>@VMCOneToMany</code> và
              <code>@VMCManyToOne</code>.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong User.java
@VMCOneToMany(mappedBy = "user")
@VMCOrphanRemoval
private List&lt;Post&gt; posts;

// Trong Post.java
@VMCManyToOne
@VMCJoinColumn(name = "user_id", referencedColumnName = "id")
private User user;
</code></pre>
            </div>
          </article>

          <article id="manytomany" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.3. Many-to-Many</h3>
            <p>Một `User` có thể có nhiều `Role`. Quan hệ này cần bảng trung gian `user_roles` và được định nghĩa bằng
              <code>@VMCManyToMany</code> và <code>@VMCJoinTable</code>.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong User.java
@VMCManyToMany
@VMCJoinTable(
        name = "user_roles",
        joinColumns = @VMCJoinColumn(name = "user_id", referencedColumnName = "id"),
        inverseJoinColumns = @VMCJoinColumn(name = "role_id", referencedColumnName = "id")
)
private Set&lt;Role&gt; roles;

// Trong Role.java
@VMCManyToMany(mappedBy = "roles")
private Set&lt;User&gt; users;
</code></pre>
            </div>
          </article>

          <article id="lazy-loading" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.4. Lazy Loading, Cascade và Orphan Removal</h3>
            <ul class="list-disc list-inside space-y-2 mt-2 text-slate-600">
              <li><strong>Lazy Loading:</strong> Là mặc định cho các quan hệ `...ToMany`. Dữ liệu chỉ được tải từ DB khi
                bạn gọi getter của collection đó lần đầu tiên.</li>
              <li><strong>Cascade Save:</strong> Để lưu theo tầng, bạn phải sử dụng phương thức `save(entity, options)`
                trong `VMCService` và truyền vào `SaveOptions` để chỉ định các quan hệ cần lưu.</li>
              <li><strong>Orphan Removal:</strong> Sử dụng annotation `@VMCOrphanRemoval` trên quan hệ `One-to-Many`
                hoặc `One-to-One`. Khi một entity con bị xóa khỏi collection của entity cha và được lưu lại, nó sẽ bị
                xóa khỏi DB.</li>
            </ul>
          </article>
        </section>

        <section id="tao-repositories" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">5. Tạo Repositories</h2>
          <p>Repository là các interface chịu trách nhiệm truy cập dữ liệu, kế thừa từ `VMCRepository<T, ID>`.
              `VMCRepository` đã cung cấp sẵn các phương thức CRUD cơ bản.</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">package io.github.natswarchuan.vmc.repository;

import io.github.natswarchuan.vmc.core.repository.VMCRepository;
import io.github.natswarchuan.vmc.entity.User;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface UserRepository extends VMCRepository&lt;User, String&gt; {
    List&lt;User&gt; findByNameContaining(String name);
}
</code></pre>
          </div>
        </section>

        <section id="phuong-thuc-truy-van" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">6. Các phương thức truy vấn</h2>

          <article id="derived-queries" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">6.1. Truy vấn phái sinh (Derived Query Methods)</h3>
            <p>Tạo truy vấn bằng cách đặt tên phương thức theo quy ước. Cú pháp: `findBy<PropertyName>[<Operator>
                  ][And|Or]...`</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong UserRepository.java
// SELECT * FROM users WHERE name LIKE ?
List&lt;User&gt; findByNameContaining(String name);

// Trong PostRepository.java
// SELECT * FROM posts WHERE title = ? AND published = ?
List&lt;Post&gt; findByTitleAndPublished(String title, boolean published);
</code></pre>
            </div>
          </article>

          <article id="vmc-query" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">6.2. Truy vấn tùy chỉnh với @VMCQuery</h3>
            <p>Đối với các truy vấn phức tạp, hãy sử dụng <code>@VMCQuery</code> với SQL native và
              <code>@VMCParam</code> để ánh xạ tham số.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong UserRepository.java
import io.github.natswarchuan.vmc.core.annotation.VMCQuery;
import io.github.natswarchuan.vmc.core.annotation.VMCParam;

@VMCQuery(value = "select u.* from users u " +
        "join user_roles ur on u.id = ur.user_id " +
        "join roles r on ur.role_id = r.id " +
        "where r.name = :roleName")
List&lt;User&gt; findUsersByRoleName(@VMCParam("roleName") String roleName);
</code></pre>
            </div>
          </article>
        </section>

        <section id="query-builder" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">7. Sử dụng VMCQueryBuilder</h2>
          <p>`VMCQueryBuilder` là một công cụ mạnh mẽ để xây dựng các câu lệnh `SELECT` động. Truy vấn phải được bắt đầu
            bằng phương thức tĩnh `VMCQueryBuilder.from(YourEntity.class)`.</p>
          <p>Ví dụ thực tế từ `UserService.findWithQueryBuilder`:</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">import io.github.natswarchuan.vmc.core.query.builder.VMCQueryBuilder;
import io.github.natswarchuan.vmc.core.query.enums.*;

// ... trong UserService.java
public List&lt;User&gt; findWithQueryBuilder(String roleName) {
    return VMCQueryBuilder.from(User.class, "u")
            .select("u.id", "u.name", "u.email")
            .join("roles", "r", VMCSqlJoinType.INNER)
            .on("r.id", "ur.role_id")
            .on("u.id", "ur.user_id")
            .where("r.name", VMCSqlOperator.EQUAL, roleName)
            .getList();
}</code></pre>
          </div>
        </section>

        <section id="service-layer" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">8. Lớp Service</h2>
          <p>Framework cung cấp một lớp `AbstractVMCService` để đơn giản hóa việc tạo các lớp service. Lớp này đã có sẵn
            các phương thức CRUD cơ bản và quan trọng là phương thức `save(T entity, SaveOptions options)` để thực hiện
            lưu theo tầng (cascade save).</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">// Trong UserService.java
import io.github.natswarchuan.vmc.core.persistence.service.SaveOptions;
import io.github.natswarchuan.vmc.core.service.AbstractVMCService;
import org.springframework.stereotype.Service;

@Service
public class UserService extends AbstractVMCService&lt;User, String, UserRepository&gt; implements IUserService {

    @Override
    public User create(UserCreateRequestDto requestDto) {
        User user = requestDto.toEntity(); // Gọi hàm toEntity từ DTO
        // Giả sử DTO có chứa danh sách các Role
        // Để lưu cả User và các Role liên quan, ta phải dùng SaveOptions
        SaveOptions options = new SaveOptions().withRelations("roles");
        return this.save(user, options);
    }
    // ... các phương thức khác
}</code></pre>
          </div>
        </section>

        <section id="dto" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">9. Làm việc với DTO</h2>
          <p>Framework cung cấp các tiện ích để làm việc với Data Transfer Objects (DTOs), giúp tách biệt lớp business
            logic với lớp persistence.</p>

          <article id="dto-mechanism" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">9.1. Cơ chế Chuyển đổi</h3>
            <div class="space-y-4">
              <p>Cơ chế chuyển đổi DTO của framework dựa trên sự tương tác giữa 3 thành phần:</p>
              <ul class="list-decimal list-inside space-y-2 text-slate-600">
                <li><strong>Lớp `BaseDto&lt;T, D&gt;`</strong>: Đây là lớp cha mà tất cả các DTO của bạn phải kế thừa.
                  Nó định nghĩa các phương thức trừu tượng `toEntity()` và `toDto()`, buộc bạn phải cung cấp logic
                  chuyển đổi.</li>
                <li><strong>Lớp DTO của bạn</strong>: Bạn implement logic chuyển đổi cụ thể trong các phương thức
                  `toEntity()` và `toDto()` mà bạn override.</li>
                <li><strong>Lớp `AbstractVMCService`</strong>: Lớp service này cung cấp các phương thức nghiệp vụ cấp
                  cao (`createFromDto`, `updateFromDto`, etc.) đóng vai trò điều phối, gọi đến các phương thức
                  `toEntity()`/`toDto()` trên đối tượng DTO để hoàn thành công việc.</li>
              </ul>
              <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-2">
                <button class="copy-btn">Copy</button>
                <pre><code class="language-java">// Trong UserCreateRequestDto.java
@Override
public User toEntity() {
    User user = new User();
    user.setName(this.name);
    user.setEmail(this.email);
    user.setPassword(this.password);
    return user;
}

// Trong BaseDto.java (để minh họa)
public D toDto(T entity) {
    BeanUtils.copyProperties(entity, this);
    return (D) this;
}
</code></pre>
              </div>
            </div>
          </article>

          <article id="dto-usage" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">9.2. Các hàm Service làm việc với DTO</h3>
            <p>`AbstractVMCService` cung cấp sẵn các phương thức để làm việc trực tiếp với DTO, giúp mã nguồn ở tầng
              Controller và Service của bạn gọn gàng hơn.</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Một vài phương thức có sẵn trong AbstractVMCService.java

// Tìm entity bằng ID và tự động chuyển thành DTO
public &lt;D extends BaseDto&lt;T, D&gt;&gt; Optional&lt;D&gt; findByIdGetDto(ID id, Class&lt;D&gt; dtoClass)

// Tạo entity từ DTO, lưu và trả về DTO đã được cập nhật (với ID, etc.)
public &lt;D extends BaseDto&lt;T, D&gt;&gt; D createFromDto(D dto, SaveOptions options)

// Cập nhật entity từ DTO, lưu và trả về DTO đã được cập nhật
public &lt;D extends BaseDto&lt;T, D&gt;&gt; D updateFromDto(ID id, D dto, SaveOptions options)

// Lưu (tạo mới hoặc cập nhật) entity từ DTO
public &lt;D extends BaseDto&lt;T, D&gt;&gt; D saveFromDto(D dto, SaveOptions options)
</code></pre>
            </div>
            <h4 class="text-xl font-semibold text-slate-700 mt-4">Ví dụ thực tế trong Controller</h4>
            <p>Với các phương thức trên, code trong Controller của bạn sẽ rất tinh gọn.</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong UserController.java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    private final IUserService userService;
    
    @GetMapping("/{id}")
    public ResponseEntity&lt;UserDetailResponseDto&gt; findById(@PathVariable String id) {
        // Gọi thẳng hàm findByIdGetDto
        return ResponseEntity.ok(userService.findByIdGetDto(id, UserDetailResponseDto.class)
            .orElseThrow(() -> new VMCException(HttpStatus.NOT_FOUND, "User not found")));
    }

    @PostMapping
    public ResponseEntity&lt;UserDetailResponseDto&gt; create(@Valid @RequestBody UserCreateRequestDto requestDto) {
        // Gọi thẳng hàm createFromDto
        return new ResponseEntity&lt;&gt;(userService.createFromDto(requestDto), HttpStatus.CREATED);
    }
}
</code></pre>
            </div>
          </article>
        </section>

        <section id="validation" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">10. Validation Dữ liệu Dựa trên Database</h2>
          <p>Framework cung cấp cơ chế validation mạnh mẽ, tích hợp với Spring Validation (`@Valid`), cho phép bạn kiểm
            tra các quy tắc nghiệp vụ dựa trên dữ liệu hiện có trong database.</p>

          <article id="validation-field" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">10.1. Validation trên Trường với @VMCQueryRule</h3>
            <p><code>@VMCQueryRule</code> được sử dụng để kiểm tra sự tồn tại hoặc duy nhất của một giá trị trong một
              cột. Nó được đặt trực tiếp trên một trường của DTO.</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Ví dụ từ UserCreateRequestDto.java
import io.github.natswarchuan.vmc.core.annotation.validation.VMCQueryRule;
import javax.validation.constraints.Email;

public class UserCreateRequestDto extends BaseDto&lt;User, String&gt; {

    private String name;

    @Email
    @VMCQueryRule(
            entity = User.class,
            field = "email",
            mustNotExist = true, // Lỗi nếu email đã tồn tại
            message = "Email already exists"
    )
    private String email;
    
    private String password;
    // ...
}</code></pre>
            </div>
          </article>

          <article id="validation-class" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">10.2. Validation Phức hợp trên Lớp với @VMCClassValidation
            </h3>
            <p><code>@VMCClassValidation</code> được sử dụng khi bạn cần kiểm tra các quy tắc phức tạp liên quan đến
              nhiều trường, nhiều điều kiện và thậm chí nhiều bảng. Nó được đặt ở cấp độ class của DTO.</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Ví dụ từ PostCreateRequestDto.java
import io.github.natswarchuan.vmc.core.annotation.validation.*;

@VMCClassValidation(
        entity = User.class,
        alias = "u",
        conditions = {
                @VMCFieldCondition(field = "userId", alias = "u", column = "id")
        },
        mustNotExist = false, // Lỗi nếu user không tồn tại
        message = "User not found"
)
public class PostCreateRequestDto extends PostBaseDto {
    private String userId;
    //...
}</code></pre>
            </div>
          </article>
        </section>
      </div>
    </main>
  </div>

  <script src="./script.js"></script>
</body>

</html>