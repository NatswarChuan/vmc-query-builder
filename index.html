<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tài liệu VMC Query Builder Framework | Hướng dẫn Tương tác</title>
  <meta name="description"
    content="Tài liệu hướng dẫn tương tác đầy đủ cho VMC Query Builder, một framework ORM và xây dựng truy vấn SQL linh hoạt cho Spring Boot. Tìm hiểu cách cài đặt, định nghĩa entity, tạo repository, và sử dụng các tính năng nâng cao.">
  <meta name="author" content="NatswarChuan">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://natswarchuan.github.io/vmc-query-builder/">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://natswarchuan.github.io/vmc-query-builder/">
  <meta property="og:title" content="Tài liệu VMC Query Builder Framework | Hướng dẫn Tương tác">
  <meta property="og:description"
    content="Tài liệu hướng dẫn tương tác đầy đủ cho VMC Query Builder, một framework ORM và xây dựng truy vấn SQL linh hoạt cho Spring Boot. Tìm hiểu cách cài đặt, định nghĩa entity, tạo repository, và sử dụng các tính năng nâng cao.">
  <meta property="og:image" content="https://natswarchuan.github.io/vmc-query-builder/logo.jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://natswarchuan.github.io/vmc-query-builder/">
  <meta property="twitter:title" content="Tài liệu VMC Query Builder Framework | Hướng dẫn Tương tác">
  <meta property="twitter:description"
    content="Tài liệu hướng dẫn tương tác đầy đủ cho VMC Query Builder, một framework ORM và xây dựng truy vấn SQL linh hoạt cho Spring Boot. Tìm hiểu cách cài đặt, định nghĩa entity, tạo repository, và sử dụng các tính năng nâng cao.">
  <meta property="twitter:image" content="https://natswarchuan.github.io/vmc-query-builder/logo.jpeg">

  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="logo.jpeg">
  <link rel="sitemap" type="application/xml" title="Sitemap" href="./sitemap.xml">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Thêm CSS cho highlight.js theme VS2015 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">

  <link rel="stylesheet" href="./style.css">

  <meta name="google-site-verification" content="IH1UdXKkUiyutr8P71xXOOkarqqdLye0EATRqOqKBE8" />
</head>

<body class="bg-slate-50 text-slate-800">

  <div class="flex flex-col md:flex-row min-h-screen">
    <aside
      class="w-full md:w-64 lg:w-72 bg-white/90 backdrop-blur-sm border-r border-slate-200 p-4 md:p-6 md:sticky top-0 h-screen overflow-y-auto">
      <h1 class="text-xl font-bold text-slate-900 mb-6">VMC Query Builder</h1>
      <nav id="navigation" class="flex flex-col space-y-2">
        <a href="#gioi-thieu"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">1. Giới
          thiệu</a>
        <a href="#cai-dat"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">2. Cài đặt &
          Cấu hình</a>
        <a href="#dinh-nghia-entities"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">3. Định nghĩa
          Entities</a>
        <div>
          <a href="#anh-xa-quan-he"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">4.
            Ánh xạ Quan hệ</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#onetoone" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.1. One-to-One</a>
            <a href="#onetomany" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.2.
              One-to-Many</a>
            <a href="#manytomany" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.3.
              Many-to-Many</a>
            <a href="#lazy-loading" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">4.4. Lazy
              Loading & Tùy chọn Thao tác</a>
          </div>
        </div>
        <a href="#tao-repositories"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">5. Tạo
          Repositories</a>
        <div>
          <a href="#phuong-thuc-truy-van"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">6.
            Phương thức Truy vấn</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#derived-queries" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">6.1. Derived
              Queries</a>
            <a href="#vmc-query" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">6.2. @VMCQuery</a>
          </div>
        </div>
        <a href="#query-builder"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">7.
          VMCQueryBuilder</a>
        <a href="#service-layer"
          class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200">8. Lớp
          Service</a>
        <div>
          <a href="#dto"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">9.
            DTO & Chuyển đổi</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#dto-mechanism" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">9.1. Cơ chế
              Chuyển đổi</a>
            <a href="#dto-usage" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">9.2. Các hàm
              Service với DTO</a>
          </div>
        </div>
        <div>
          <a href="#validation"
            class="nav-link text-slate-600 hover:bg-slate-100 p-2 rounded-md transition-colors duration-200 block">10.
            Validation Dữ liệu</a>
          <div class="ml-4 mt-2 space-y-2 border-l-2 border-slate-200 pl-4">
            <a href="#validation-field" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">10.1.
              Validation trên Trường</a>
            <a href="#validation-class" class="nav-sublink block text-sm text-slate-500 hover:text-blue-600">10.2.
              Validation trên Lớp</a>
          </div>
        </div>
      </nav>
    </aside>

    <main class="flex-1 p-6 md:p-10">
      <div class="max-w-4xl mx-auto">
        <section id="gioi-thieu" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">1. Giới thiệu</h2>
          <p class="text-lg text-slate-700"><strong>VMC Query Builder</strong> là một mini-framework cung cấp các chức
            năng ORM (Object-Relational Mapping) và xây dựng truy vấn SQL một cách linh hoạt, được tích hợp sâu với
            Spring Boot. Framework này cho phép bạn tương tác với cơ sở dữ liệu quan hệ bằng cách sử dụng các đối tượng
            Java (Entities) và các interface (Repositories), giúp giảm thiểu việc viết mã SQL thủ công và tăng tốc độ
            phát triển.</p>
          <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
            <h3 class="text-xl font-semibold mb-3 text-slate-800">Các tính năng chính</h3>
            <ul class="list-disc list-inside space-y-2 text-slate-600">
              <li><strong>Ánh xạ dựa trên Annotation:</strong> Dễ dàng ánh xạ các lớp Java thành các bảng trong cơ sở dữ
                liệu.</li>
              <li><strong>Mô hình Repository:</strong> Cung cấp một lớp trừu tượng cho tầng truy cập dữ liệu, tương tự
                như Spring Data.</li>
              <li><strong>Truy vấn phát sinh (Derived Queries):</strong> Tự động sinh câu lệnh SQL từ tên của phương
                thức.</li>
              <li><strong>Query Builder linh hoạt:</strong> Cung cấp một API fluent để xây dựng các câu lệnh `SELECT`
                phức tạp.</li>
              <li><strong>Hỗ trợ các mối quan hệ:</strong> Quản lý đầy đủ các mối quan hệ `One-to-One`, `One-to-Many`,
                `Many-to-One`, và `Many-to-Many`.</li>
              <li><strong>Lazy Loading & Tùy chọn Thao tác:</strong> Tối ưu hóa hiệu năng và cung cấp các tùy chọn nâng
                cao cho việc lưu và xóa dữ liệu theo tầng.</li>
              <li><strong>Tích hợp Service Layer & DTO:</strong> Cung cấp các lớp cơ sở để giảm mã lặp lại và dễ dàng
                chuyển đổi dữ liệu.</li>
              <li><strong>Validation Truy vấn:</strong> Cung cấp cơ chế validation mạnh mẽ dựa trên dữ liệu trong
                database.</li>
            </ul>
          </div>
        </section>

        <section id="cai-dat" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">2. Cài đặt & Cấu hình</h2>
          <p>Để bắt đầu, bạn cần tích hợp framework vào dự án Spring Boot của mình.</p>
          <h3 class="text-2xl font-semibold text-slate-800 pt-4">Bước 1: Thêm Dependency (Maven)</h3>
          <p>Đảm bảo `pom.xml` của bạn có các dependency cần thiết. Framework này sử dụng `spring-boot-starter-jdbc`.
          </p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-xml">&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;jitpack.io&lt;/id&gt;
        &lt;url&gt;https://jitpack.io&lt;/url&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;
&lt;properties&gt;
 &lt;!-- Phiên bản mới nhất lấy tại "https://jitpack.io/#natswarchuan/vmc-query-builder" --&gt;
    &lt;vmc.version&gt;${Phiên bản mới nhất}&lt;/vmc.version&gt;
    &lt;lombok.version&gt;1.18.30&lt;/lombok.version&gt;
&lt;/properties&gt;
&lt;dependencies&gt;
    &lt;!-- Thư viện VMC Query Builder --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.github.natswarchuan&lt;/groupId&gt;
        &lt;artifactId&gt;vmc-query-builder&lt;/artifactId&gt;
        &lt;version&gt;${vmc.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- Spring Boot Starter cho việc xây dựng ứng dụng web, bao gồm RESTful API --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- Spring Boot Starter cho việc xác thực dữ liệu (validation) --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- Cung cấp trình kết nối JDBC cho MySQL để ứng dụng có thể giao tiếp với cơ sở dữ liệu MySQL --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;
        &lt;scope&gt;runtime&lt;/scope&gt;
    &lt;/dependency&gt;

    &lt;!-- lombok cho việc tạo các getter, setter và constructor đơn giản --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
        &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;version&gt;${lombok.version}&lt;/version&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
          </div>

          <h3 class="text-2xl font-semibold text-slate-800 pt-4">Bước 2: Cấu hình DataSource</h3>
          <p>Trong file `application.properties`, cấu hình thông tin kết nối đến cơ sở dữ liệu.</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-properties">spring.datasource.url=jdbc:mysql://localhost:3306/vmc_db
spring.datasource.username=root
spring.datasource.password=
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</code></pre>
          </div>


        </section>

        <section id="dinh-nghia-entities" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">3. Định nghĩa Entities</h2>
          <p>Entities là các lớp Java đại diện cho các bảng trong cơ sở dữ liệu. Tất cả các entity phải kế thừa từ lớp
            `Model`.</p>
          <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-md" role="alert">
            <p class="font-bold">Annotation cơ bản</p>
            <ul class="list-disc list-inside mt-2">
              <li><code>@VMCTable(name = "...")</code>: Đánh dấu lớp là entity và chỉ định tên bảng.</li>
              <li><code>@VMCPrimaryKey</code>: Đánh dấu trường là khóa chính.</li>
              <li><code>@VMCColumn(name = "...")</code>: Ánh xạ trường thành cột. Nếu không có `name`, tên cột sẽ được
                lấy từ tên trường.</li>
            </ul>
          </div>
          <h3 class="text-2xl font-semibold text-slate-800 pt-4">Ví dụ: Entity `User`</h3>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">package io.github.natswarchuan.vmc.entity;

import io.github.natswarchuan.vmc.core.annotation.*;
import io.github.natswarchuan.vmc.core.entity.Model;
import java.time.LocalDateTime;
import lombok.*;

@Data
@VMCTable(name = "users")
public class User extends Model {

  @VMCPrimaryKey(name = "id")
  @VMCColumn(name = "id")
  private Long id;

  @VMCColumn(name = "name")
  private String name;

  @VMCColumn(name = "email")
  private String email;

  @VMCColumn(name = "created_at")
  private LocalDateTime createdAt;

  @VMCColumn(name = "updated_at")
  private LocalDateTime updatedAt;
    // ...
}
</code></pre>
          </div>
        </section>

        <section id="anh-xa-quan-he" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">4. Ánh xạ Quan hệ</h2>
          <p>Framework hỗ trợ đầy đủ các mối quan hệ phổ biến trong ORM.</p>

          <article id="onetoone" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.1. One-to-One</h3>
            <p>Mỗi `User` có một `UserProfile`. Quan hệ này được định nghĩa bằng <code>@VMCOneToOne</code> và
              <code>@VMCJoinColumn</code>.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong User.java
@VMCOneToOne(mappedBy = "user")
private UserProfile profile;

// Trong UserProfile.java
@VMCOneToOne
@VMCJoinColumn(name = "user_id")
private User user;
</code></pre>
            </div>
          </article>

          <article id="onetomany" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.2. One-to-Many / Many-to-One</h3>
            <p>Một `User` có thể viết nhiều `Post`. Quan hệ này được thể hiện bằng <code>@VMCOneToMany</code> và
              <code>@VMCManyToOne</code>.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong User.java
@VMCOneToMany(mappedBy = "user")
private List&lt;Post&gt; posts;

// Trong Post.java
@VMCManyToOne
@VMCJoinColumn(name = "user_id")
private User user;
</code></pre>
            </div>
          </article>

          <article id="manytomany" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.3. Many-to-Many</h3>
            <p>Một `User` có thể có nhiều `Role`. Quan hệ này cần bảng trung gian `user_roles` và được định nghĩa bằng
              <code>@VMCManyToMany</code> và <code>@VMCJoinTable</code>.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong User.java
@VMCManyToMany
@VMCJoinTable(
    name = "user_roles",
    joinColumns = @VMCJoinColumn(name = "user_id"),
    inverseJoinColumns = @VMCJoinColumn(name = "role_id"))
private Set&lt;Role&gt; roles;

// Trong Role.java
@VMCManyToMany(mappedBy = "roles")
private Set&lt;User&gt; users;
</code></pre>
            </div>
          </article>

          <article id="lazy-loading" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">4.4. Lazy Loading & Tùy chọn Thao tác</h3>
            <div class="space-y-6">
              <div>
                <h4 class="text-xl font-semibold text-slate-700">Lazy Loading (Tải lười)</h4>
                <p class="mt-2 text-slate-600">Đây là hành vi mặc định cho các mối quan hệ tập hợp
                  (<code>One-to-Many</code>, <code>Many-to-Many</code>) để tối ưu hiệu suất. Thay vì tải tất cả các thực
                  thể liên quan cùng một lúc, framework sẽ chỉ thực hiện truy vấn để lấy dữ liệu của collection khi bạn
                  truy cập vào nó lần đầu tiên (ví dụ: gọi <code>user.getPosts()</code>).</p>
              </div>
              <div>
                <h4 class="text-xl font-semibold text-slate-700">Tùy chọn Lưu (SaveOptions)</h4>
                <p class="mt-2 text-slate-600">Cho phép bạn lưu một thực thể cha và tự động lưu tất cả các
                  thực thể con liên quan trong cùng một thao tác (<strong>Cascade Save</strong>). <strong>Quan
                    trọng:</strong> Tính năng này không được
                  bật mặc định. Để kích hoạt, bạn phải tạo một đối tượng <code>SaveOptions</code>, sử dụng phương thức
                  <code>.with("ten_quan_he")</code> để chỉ định các mối quan hệ cần lưu, và truyền nó vào phương thức
                  <code>save()</code>.
                </p>
                <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-3">
                  <button class="copy-btn">Copy</button>
                  <pre><code class="language-java">// Ví dụ trong UserService
public User createUserAndProfile(UserCreateDto dto) {
    User user = dto.toEntity(); // user có chứa một đối tượng UserProfile mới
    
    // Chỉ định rằng chúng ta muốn lưu cả quan hệ 'profile'
    SaveOptions options = new SaveOptions().with("profile");
    
    // Lưu user, và UserProfile liên quan cũng sẽ được lưu tự động
    return this.save(user, options); 
}
</code></pre>
                </div>
              </div>
              <div>
                <h4 class="text-xl font-semibold text-slate-700">Tùy chọn Xóa (RemoveOptions)</h4>
                <p class="mt-2 text-slate-600">Tương tự như `SaveOptions`, `RemoveOptions` cung cấp một cách tường minh
                  để kiểm soát hành vi <strong>xóa theo tầng (Cascade Remove)</strong>. Khi bạn xóa một thực thể cha,
                  bạn có thể chỉ định để tự động xóa tất cả các thực thể con liên quan.</p>
                <p class="mt-2 text-slate-600">Để kích hoạt, bạn cần tạo một đối tượng <code>RemoveOptions</code>, sử
                  dụng phương thức <code>.with("ten_quan_he")</code> để chỉ định các mối quan hệ cần xóa theo, và truyền
                  nó vào phương thức <code>remove()</code> hoặc <code>removeById()</code>.</p>
                <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-3">
                  <button class="copy-btn">Copy</button>
                  <pre><code class="language-java">// ... trong UserService
import io.github.natswarchuan.vmc.core.persistence.service.RemoveOptions;

// Ví dụ: Xóa cứng User và tất cả các Post, Profile liên quan
public void deleteUserAndAssociations(Long userId) {
    RemoveOptions options = new RemoveOptions()
                                  .with("posts")    // Xóa các Post liên quan
                                  .with("profile"); // Xóa UserProfile liên quan
                                  
    repository.removeById(userId, options);
}
</code></pre>
                </div>
              </div>
            </div>
          </article>
        </section>

        <section id="tao-repositories" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">5. Tạo Repositories</h2>
          <p>Repository là các interface chịu trách nhiệm truy cập dữ liệu, kế thừa từ `VMCRepository<T, ID>`.
              `VMCRepository` đã cung cấp sẵn các phương thức CRUD cơ bản.</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">package io.github.natswarchuan.vmc.repository;

import io.github.natswarchuan.vmc.core.repository.VMCRepository;
import io.github.natswarchuan.vmc.entity.User;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface UserRepository extends VMCRepository&lt;User, Long &gt; {
  List&lt;User&gt; findByNameContaining(String name);
}
</code></pre>
          </div>
        </section>

        <section id="phuong-thuc-truy-van" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">6. Các phương thức truy vấn</h2>
          <p>Framework cung cấp hai cách chính để định nghĩa các truy vấn trong interface Repository của bạn:
            <strong>Truy vấn phát (Derived Queries)</strong> và <strong>Truy vấn tùy chỉnh (Custom Queries)</strong>.
          </p>

          <article id="derived-queries" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">6.1. Truy vấn phát sinh (Derived Query Methods)</h3>
            <p>Đây là cách mạnh mẽ nhất để tạo truy vấn mà không cần viết một dòng SQL nào. Framework sẽ tự động phân
              tích tên phương thức của bạn và tạo ra câu lệnh SQL tương ứng. Cấu trúc của tên phương thức tuân theo mẫu
              sau:</p>
            <p class="font-mono bg-slate-100 p-2 rounded-md text-sm mt-2">
              <code>(action)(Dto)?(quantifier)By(criteria)(OrderBy...)</code>
            </p>

            <div class="mt-4 space-y-2">
              <p><strong>Action:</strong> Tiền tố bắt buộc, xác định hành động của truy vấn. Bao gồm: <code>find</code>,
                <code>get</code>, <code>count</code>, <code>delete</code>, <code>remove</code>.
              </p>
              <p><strong>Dto (Tùy chọn):</strong> Nếu có từ khóa `Dto`, phương thức sẽ tự động trả về đối tượng DTO thay
                vì Entity.</p>
              <p><strong>Quantifier (Tùy chọn):</strong> Giới hạn kết quả trả về. Bao gồm: <code>All</code> (mặc định
                nếu trả về List), <code>First</code> (trả về một đối tượng duy nhất).</p>
              <p><strong>Criteria:</strong> Phần quan trọng nhất, bắt đầu bằng từ khóa <code>By</code>. Bạn định nghĩa
                các điều kiện `WHERE` bằng cách kết hợp tên thuộc tính của Entity với các toán tử được hỗ trợ. Các điều
                kiện có thể được nối với nhau bằng <code>And</code> hoặc <code>Or</code>.</p>
              <p><strong>OrderBy (Tùy chọn):</strong> Sắp xếp kết quả. Cú pháp:
                <code>OrderBy&lt;PropertyName&gt;Asc|Desc</code>.
              </p>
            </div>

            <h4 class="text-xl font-semibold text-slate-700 mt-4">Các toán tử điều kiện được hỗ trợ</h4>
            <table class="w-full mt-2 border-collapse text-left">
              <thead class="bg-slate-100">
                <tr>
                  <th class="p-2 border">Từ khóa</th>
                  <th class="p-2 border">Ví dụ</th>
                  <th class="p-2 border">SQL tương đương</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-b">
                  <td class="p-2 border font-mono">Like, Containing</td>
                  <td class="p-2 border font-mono">findByNameContaining(String name)</td>
                  <td class="p-2 border font-mono">WHERE name LIKE ?</td>
                </tr>
                <tr class="border-b">
                  <td class="p-2 border font-mono">In</td>
                  <td class="p-2 border font-mono">findByStatusIn(Collection&lt;String&gt; statuses)</td>
                  <td class="p-2 border font-mono">WHERE status IN (...)</td>
                </tr>
                <tr class="border-b">
                  <td class="p-2 border font-mono">Between</td>
                  <td class="p-2 border font-mono">findByAgeBetween(int start, int end)</td>
                  <td class="p-2 border font-mono">WHERE age BETWEEN ? AND ?</td>
                </tr>
                <tr class="border-b">
                  <td class="p-2 border font-mono">GreaterThan, LessThan, ...Equal</td>
                  <td class="p-2 border font-mono">findByStartDateGreaterThanEqual(Date date)</td>
                  <td class="p-2 border font-mono">WHERE start_date >= ?</td>
                </tr>
                <tr class="border-b">
                  <td class="p-2 border font-mono">IsNull, IsNotNull</td>
                  <td class="p-2 border font-mono">findByEndDateIsNull()</td>
                  <td class="p-2 border font-mono">WHERE end_date IS NULL</td>
                </tr>
                <tr class="border-b">
                  <td class="p-2 border font-mono">True, False</td>
                  <td class="p-2 border font-mono">findByIsActiveTrue()</td>
                  <td class="p-2 border font-mono">WHERE is_active = true</td>
                </tr>
              </tbody>
            </table>

            <h4 class="text-xl font-semibold text-slate-700 mt-4">Ví dụ thực tế</h4>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong UserRepository.java

// Tìm tất cả user có tên chứa một chuỗi và sắp xếp theo email giảm dần
// SELECT * FROM users WHERE name LIKE ? ORDER BY email DESC
List&lt;User&gt; findByNameContainingOrderByEmailDesc(String name);

// Đếm số lượng user có email cụ thể
// SELECT COUNT(*) FROM users WHERE email = ?
long countByEmail(String email);

// Tìm user đầu tiên có tuổi lớn hơn một giá trị
// SELECT * FROM users WHERE age > ? LIMIT 1
Optional&lt;User&gt; findFirstByAgeGreaterThan(int age);

// Xóa tất cả user được tạo trước một ngày
// DELETE FROM users WHERE created_at < ?
void deleteByCreatedAtLessThan(LocalDateTime date);

// Tìm DTO của user bằng email
// Tự động chuyển đổi User entity sang UserDto
Optional&lt;UserDto&gt; findDtoByEmail(String email);
</code></pre>
            </div>
          </article>

          <article id="vmc-query" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">6.2. Truy vấn tùy chỉnh với @VMCQuery</h3>
            <p>Đối với các truy vấn phức tạp không thể biểu diễn bằng tên phương thức, bạn có thể sử dụng
              <code>@VMCQuery</code> để viết câu lệnh SQL gốc. Các tham số của phương thức phải được đánh dấu bằng
              <code>@VMCParam</code> để ánh xạ với các tham số được đặt tên trong câu lệnh SQL.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong UserRepository.java
import io.github.natswarchuan.vmc.core.annotation.VMCQuery;
import io.github.natswarchuan.vmc.core.annotation.VMCParam;

@VMCQuery(value = "SELECT u.* FROM users u " +
        "JOIN user_roles ur ON u.id = ur.user_id " +
        "JOIN roles r ON ur.role_id = r.id " +
        "WHERE r.name = :roleName")
List&lt;User&gt; findUsersByRoleName(@VMCParam("roleName") String roleName);
</code></pre>
            </div>
          </article>
        </section>

        <section id="query-builder" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">7. Sử dụng VMCQueryBuilder</h2>
          <p>`VMCQueryBuilder` là một công cụ mạnh mẽ để xây dựng các câu lệnh `SELECT` động. Truy vấn phải được bắt đầu
            bằng phương thức tĩnh `VMCQueryBuilder.from(YourEntity.class)`.</p>
          <p>Ví dụ thực tế từ `UserService.findWithQueryBuilder`:</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">import io.github.natswarchuan.vmc.core.query.builder.VMCQueryBuilder;
import io.github.natswarchuan.vmc.core.query.enums.*;

// ... trong UserService.java
  public List<User> findWithQueryBuilder(String roleName) {
    return VMCQueryBuilder.from(User.class, "u")
        .join(VMCSqlJoinType.INNER_JOIN, "user_roles", "ur", "u.id", "=", "ur.user_id")
        .join(VMCSqlJoinType.INNER_JOIN, "roles", "r", "ur.role_id", "=", "r.id")
        .where("r.name", VMCSqlOperator.LIKE, roleName)
        .get();
}</code></pre>
          </div>
        </section>

        <section id="service-layer" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">8. Lớp Service</h2>
          <p>Framework cung cấp một lớp `AbstractVMCService` để đơn giản hóa việc tạo các lớp service. Lớp này đã có sẵn
            các phương thức CRUD cơ bản và quan trọng là phương thức `save(T entity, SaveOptions options)` để thực hiện
            lưu theo tầng (cascade save).</p>
          <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
            <button class="copy-btn">Copy</button>
            <pre><code class="language-java">// Trong UserService.java
import io.github.natswarchuan.vmc.core.persistence.service.SaveOptions;
import io.github.natswarchuan.vmc.core.service.AbstractVMCService;
import org.springframework.stereotype.Service;

@Service
public class UserService extends AbstractVMCService&lt;User, String, UserRepository&gt; implements IUserService {

    @Override
    public User create(UserCreateRequestDto requestDto) {
        User user = requestDto.toEntity(); // Gọi hàm toEntity từ DTO
        // Giả sử DTO có chứa danh sách các Role
        // Để lưu cả User và các Role liên quan, ta phải dùng SaveOptions
        SaveOptions options = new SaveOptions().withRelations("roles");
        return this.save(user, options);
    }
    // ... các phương thức khác
}</code></pre>
          </div>
        </section>

        <section id="dto" class="mb-12 space-y-4 scroll-mt-20">
          <h2 class="text-3xl font-bold text-slate-900 border-b pb-2">9. Làm việc với DTO</h2>
          <p>Framework cung cấp các tiện ích để làm việc với Data Transfer Objects (DTOs), giúp tách biệt lớp business
            logic với lớp persistence.</p>

          <article id="dto-mechanism" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">9.1. Cơ chế Chuyển đổi</h3>
            <div class="space-y-4">
              <p>Cơ chế chuyển đổi DTO của framework dựa trên sự tương tác giữa 3 thành phần:</p>
              <ul class="list-decimal list-inside space-y-2 text-slate-600">
                <li><strong>Interface `BaseDto&lt;E, D&gt;`</strong>: Đây là interface mà tất cả các DTO của bạn phải
                  triển khai. Nó định nghĩa các phương thức `toEntity()` và `toDto(Model entity)`, buộc bạn phải cung
                  cấp logic chuyển đổi.</li>
                <li><strong>Lớp DTO của bạn</strong>: Bạn implement logic chuyển đổi cụ thể trong các phương thức
                  `toEntity()` và `toDto()` mà bạn override.</li>
                <li><strong>Lớp `AbstractVMCService`</strong>: Lớp service này cung cấp các phương thức nghiệp vụ cấp
                  cao (`createFromDto`, `updateFromDto`, etc.) đóng vai trò điều phối, gọi đến các phương thức
                  `toEntity()`/`toDto()` trên đối tượng DTO để hoàn thành công việc.</li>
              </ul>
              <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-2">
                <button class="copy-btn">Copy</button>
                <pre><code class="language-java">// Trong UserCreateRequestDto.java
@Override
public User toEntity() {
    User user = new User();
    // Sao chép các thuộc tính từ DTO sang Entity
    user.setName(this.name);
    user.setEmail(this.email);
    user.setPassword(this.password); // (Lưu ý: nên mã hóa mật khẩu ở đây)
    return user;
}

// Trong UserResponseDto.java
@Override
public UserResponseDto toDto(Model entity) {
    if (entity instanceof User) {
        User user = (User) entity;
        // Sao chép các thuộc tính từ Entity sang DTO
        this.setId(user.getId());
        this.setName(user.getName());
        this.setEmail(user.getEmail());
    }
    return this;
}
</code></pre>
              </div>
            </div>
          </article>

          <article id="dto-usage" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">9.2. Các hàm Service linh hoạt với DTO</h3>
            <p>`AbstractVMCService` cung cấp sẵn các phương thức được nạp chồng (overloaded) để làm việc trực tiếp với
              DTO. Đặc biệt, nó cho phép bạn nhận một loại DTO làm đầu vào (ví dụ: `RequestDto`) và trả về một loại DTO
              khác làm đầu ra (ví dụ: `ResponseDto`).</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Một vài phương thức nạp chồng có sẵn trong VMCService.java

// Tạo entity từ một DTO đầu vào và trả về một DTO đầu ra khác
&lt;I extends BaseDto&lt;T, I&gt;, O extends BaseDto&lt;T, O&gt;&gt; O createFromDto(I requestDto, Class&lt;O&gt; responseDtoClass, SaveOptions options);

// Cập nhật entity từ một DTO đầu vào và trả về một DTO đầu ra khác
&lt;I extends BaseDto&lt;T, I&gt;, O extends BaseDto&lt;T, O&gt;&gt; O updateFromDto(ID id, I requestDto, Class&lt;O&gt; responseDtoClass, SaveOptions options);

// Tìm entity bằng ID và tự động chuyển thành DTO
&lt;D extends BaseDto&lt;T, D&gt;&gt; Optional&lt;D&gt; findByIdGetDto(ID id, Class&lt;D&gt; dtoClass);
</code></pre>
            </div>
            <h4 class="text-xl font-semibold text-slate-700 mt-4">Ví dụ thực tế trong Controller</h4>
            <p>Với các phương thức trên, code trong Controller của bạn sẽ rất tinh gọn và rõ ràng, tách biệt hoàn toàn
              giữa dữ liệu request và response.</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong UserController.java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    private final IUserService userService;
    
    @GetMapping("/{id}")
    public ResponseEntity&lt;UserResponseDto&gt; findById(@PathVariable String id) {
        return ResponseEntity.ok(userService.findByIdGetDto(id, UserResponseDto.class)
            .orElseThrow(() -> new VMCException(HttpStatus.NOT_FOUND, "User not found")));
    }

    @PostMapping
    public ResponseEntity&lt;UserResponseDto&gt; create(@Valid @RequestBody UserCreateRequestDto requestDto) {
        // Gọi hàm createFromDto mới, chỉ định DTO trả về là UserResponseDto
        SaveOptions options = new SaveOptions().with("profile").with("roles");
        UserResponseDto responseDto = userService.createFromDto(requestDto, UserResponseDto.class, options);
        return new ResponseEntity&lt;&gt;(responseDto, HttpStatus.CREATED);
    }
}
</code></pre>
            </div>
          </article>
        </section>

        <section id="validation" class="scroll-mt-16">
          <h2 class="text-3xl font-bold text-slate-900">10. Validation Dữ liệu Dựa trên Database</h2>
          <p class="mt-4 text-lg text-slate-700">
            VMC Framework cung cấp một cơ chế validation mạnh mẽ, cho phép bạn định nghĩa các quy tắc kiểm tra dữ liệu
            dựa trên trạng thái của database ngay trong DTO, sử dụng các annotation chuyên dụng.
          </p>

          <article id="validation-field" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">10.1. Validation mức Trường (Field-Level)</h3>
            <p class="mt-2 text-slate-700">
              Validation ở mức trường được dùng để kiểm tra các quy tắc liên quan đến một trường dữ liệu duy nhất.
            </p>

            <h4 class="text-xl font-medium text-slate-800 mt-4">10.1.1. @VMCQueryRule: Kiểm tra Đơn giản</h4>
            <p class="mt-2 text-slate-700">
              Đây là annotation được thiết kế cho các kịch bản kiểm tra phổ biến nhất: <strong>kiểm tra sự tồn tại
                (existence)</strong> hoặc <strong>tính duy nhất (uniqueness)</strong> của một giá trị.
            </p>
            <p class="mt-2 font-semibold text-slate-800">Các thuộc tính chính:</p>
            <ul class="mt-2 list-disc list-inside text-slate-700 space-y-1">
              <li><code>entity</code>: Lớp Entity mục tiêu để thực hiện truy vấn.</li>
              <li><code>field</code>: Tên cột trong database để so sánh với giá trị của trường được validate.</li>
              <li><code>operator</code>: Toán tử so sánh (mặc định là `EQUAL`).</li>
              <li><code>mustNotExist</code>: Logic kiểm tra.
                <ul class="ml-6 list-disc list-inside">
                  <li>`true`: Dùng để kiểm tra tính duy nhất. Validation thất bại nếu query tìm thấy bản ghi.</li>
                  <li>`false`: Dùng để kiểm tra sự tồn tại. Validation thất bại nếu query không tìm thấy bản ghi.</li>
                </ul>
              </li>
              <li><code>message</code>: Thông báo lỗi.</li>
            </ul>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-2">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Ví dụ: Kiểm tra email duy nhất khi tạo user
import io.github.natswarchuan.vmc.core.annotation.validation.VMCQueryRule;
import io.github.natswarchuan.vmc.entity.User;

public class UserCreateRequestDto {
    // ...
    @VMCQueryRule(
        entity = User.class,
        field = "email", // So sánh với cột "email" trong bảng users
        mustNotExist = true, // Lỗi nếu email này đã tồn tại
        message = "Email đã tồn tại."
    )
    private String email;
    // ...
}</code></pre>
            </div>

            <h4 class="text-xl font-medium text-slate-800 mt-4">10.1.2. @VMCQueryValidation: Kiểm tra Nâng cao với SQL
            </h4>
            <p class="mt-2 text-slate-700">
              Annotation này cung cấp sự linh hoạt tối đa khi bạn cần viết một câu lệnh <strong>SQL tùy chỉnh</strong>
              để validation. Nó có thể được dùng ở cả mức trường và mức lớp.
            </p>
            <p class="mt-2 font-semibold text-slate-800">Các thuộc tính và tham số:</p>
            <ul class="mt-2 list-disc list-inside text-slate-700 space-y-1">
              <li><code>query</code>: Câu lệnh SQL gốc để thực thi.</li>
              <li><code>mustNotExist</code>: Logic kiểm tra. `true` (mặc định) thì validation thất bại nếu query có kết
                quả. `false` thì validation thất bại nếu query không có kết quả.</li>
              <li>Tham số trong query:
                <ul class="ml-6 list-disc list-inside">
                  <li><code>:this</code>: (Chỉ dùng ở mức trường) Giá trị của chính trường đang được validate.</li>
                  <li><code>:fieldName</code> hoặc <code>:body.fieldName</code>: Giá trị của trường `fieldName` trong
                    DTO.</li>
                  <li><code>:path.variableName</code>: Giá trị của Path Variable `variableName` từ URL.</li>
                  <li><code>:param.parameterName</code>: Giá trị của Request Parameter `parameterName` từ URL.</li>
                </ul>
              </li>
            </ul>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-2">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Ví dụ: Kiểm tra email duy nhất khi cập nhật user, URL: /users/{id}
@VMCQueryValidation(
    query = "SELECT id FROM users WHERE email = :this AND id != :path.id",
    message = "Email đã được sử dụng bởi người dùng khác."
)
private String email;</code></pre>
            </div>
          </article>

          <article id="validation-class" class="scroll-mt-20 pt-4">
            <h3 class="text-2xl font-semibold text-slate-800">10.2. Validation mức Lớp với @VMCClassValidation</h3>
            <p class="mt-2 text-slate-700">
              <code>@VMCClassValidation</code> được sử dụng khi bạn cần kiểm tra các quy tắc phức tạp liên quan đến
              nhiều trường, nhiều điều kiện và thậm chí nhiều bảng. Nó được đặt ở cấp độ class của DTO và có thể được
              dùng nhiều lần trên cùng một class.
            </p>
            <p class="mt-2 font-semibold text-slate-800">Các thuộc tính chính:</p>
            <ul class="mt-2 list-disc list-inside text-slate-700 space-y-1">
              <li><code>entity</code>: Lớp Entity gốc để bắt đầu truy vấn.</li>
              <li><code>alias</code>: Bí danh cho entity gốc (mặc định là "root").</li>
              <li><code>conditions</code>: Mảng các <code>@VMCFieldCondition</code> để xây dựng mệnh đề `WHERE`.</li>
              <li><code>joins</code>: Mảng các <code>@VMCJoin</code> để join với các bảng khác.</li>
              <li><code>mustNotExist</code>: Logic kiểm tra. <code>true</code> (mặc định) là kiểm tra **sự không tồn
                tại** (lỗi nếu record đã tồn tại). <code>false</code> là kiểm tra **sự tồn tại** (lỗi nếu record không
                tồn tại).</li>
            </ul>

            <h4 class="text-xl font-medium text-slate-800 mt-4">Ví dụ 1: Kiểm tra sự tồn tại của Khóa ngoại</h4>
            <p class="mt-2 text-slate-700">
              Khi tạo một bài viết (Post), cần đảm bảo <code>userId</code> và <code>categoryId</code> được cung cấp là
              hợp lệ.
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-2">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong file: dto/post/request/PostCreateRequestDto.java
import io.github.natswarchuan.vmc.core.annotation.validation.*;
import io.github.natswarchuan.vmc.entity.*;

@VMCClassValidation(
    entity = User.class,
    conditions = {
      @VMCFieldCondition(name = "userId", source = VMCFieldCondition.Source.BODY)
    },
    mustNotExist = false, // Lỗi nếu User KHÔNG tồn tại
    message = "Người dùng không tồn tại."
)
@VMCClassValidation(
    entity = Category.class,
    conditions = {
      @VMCFieldCondition(name = "categoryId", source = VMCFieldCondition.Source.BODY)
    },
    mustNotExist = false, // Lỗi nếu Category KHÔNG tồn tại
    message = "Danh mục không tồn tại."
)
public class PostCreateRequestDto {
    private String userId;
    private String categoryId;
    //...
}</code></pre>
            </div>

            <h4 class="text-xl font-medium text-slate-800 mt-4">Ví dụ 2: Validation Quyền sở hữu với JOIN</h4>
            <p class="mt-2 text-slate-700">
              Kịch bản: Khi cập nhật một bài viết, cần xác thực rằng bài viết (lấy ID từ URL) thực sự thuộc về user (lấy
              thông tin từ body request).
            </p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg shadow-md mt-2">
              <button class="copy-btn">Copy</button>
              <pre><code class="language-java">// Trong file: dto/post/request/PostUpdateRequestDto.java
import io.github.natswarchuan.vmc.core.annotation.validation.*;
import io.github.natswarchuan.vmc.entity.*;

@VMCClassValidation(
    entity = Post.class, // Bảng gốc là Post
    alias = "root",
    joins = {
      @VMCJoin(entity = User.class, alias = "u", from = "root.user_id", to = "u.id")
    },
    conditions = {
      @VMCFieldCondition(name = "id", source = VMCFieldCondition.Source.PATH, alias = "root"),
      @VMCFieldCondition(name = "userId", source = VMCFieldCondition.Source.BODY, alias = "u", column = "id")
    },
    mustNotExist = false, // Phải tìm thấy record thỏa mãn
    message = "Bài viết không tồn tại, hoặc bạn không có quyền chỉnh sửa bài viết này."
)
public class PostUpdateRequestDto {
    private String userId; 
    // ...
}</code></pre>
            </div>
            <p class="mt-2 text-slate-700">
              <strong>Luồng hoạt động:</strong> Framework sẽ xây dựng một truy vấn phức hợp tương đương:
              <code>SELECT COUNT(*) FROM posts root JOIN users u ON root.user_id = u.id WHERE root.id = ? AND u.id = ?</code>.
              Giá trị đầu tiên lấy từ path variable, giá trị thứ hai lấy từ trường <code>userId</code> trong request
              body. Nếu không tìm thấy record nào, validation sẽ thất bại.
            </p>
          </article>
        </section>
      </div>
    </main>
  </div>

  <!-- Thêm thư viện highlight.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <!-- Kích hoạt highlight.js -->
  <script>hljs.highlightAll();</script>

  <script src="./script.js"></script>
</body>

</html>